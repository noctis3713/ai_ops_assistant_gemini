# ğŸŒ å¤–éƒ¨-å®¿ä¸»æ©Ÿ-Dockerç¶²è·¯æ‹“æ’²æ¶æ§‹

## ğŸ“Š ç¶²è·¯å±¤ç´šæ¶æ§‹

```
Internet (å¤–ç¶²)
      â†“ 
202.3.184.82 (å¤–éƒ¨IP)
      â†“	NAT
10.60.21.11/24 (å®¿ä¸»æ©Ÿå…§ç¶²IP, ens160)
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®¿ä¸»æ©Ÿ (Ubuntu)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Bridge Networks: (å››å€‹ç¶²è·¯çµ±ä¸€ç®¡ç†æ¨¡å¼)                   â”‚
â”‚  â€¢ docker0: 172.17.0.1/16 (é è¨­)                       â”‚
â”‚  â€¢ br-4dd659933249: 172.21.0.1/16 (ai-ops-network)    â”‚
â”‚  â€¢ br-903859ba5897: 172.22.0.1/16 (akvorado-network)  â”‚
â”‚  â€¢ br-2ea55f987da5: 172.23.0.1/16 (grafana-network)   â”‚
â”‚  â€¢ br-8dc43b2bf838: 172.99.0.1/16 (postgres-network)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ai-ops-network  â”‚ â”‚grafana-network  â”‚ â”‚akvorado-network â”‚ â”‚postgres-network â”‚
â”‚ 172.21.0.0/16   â”‚ â”‚ 172.23.0.0/16   â”‚ â”‚ 172.22.0.0/16   â”‚ â”‚ 172.99.0.0/16   â”‚
â”‚ ğŸ·ï¸ AIé‹ç¶­ç³»çµ±   â”‚ â”‚ ğŸ·ï¸ ç›£æ§ç³»çµ±     â”‚ â”‚ ğŸ·ï¸ ç¶²è·¯åˆ†æ     â”‚ â”‚ ğŸ·ï¸ è³‡æ–™åº«ç³»çµ±   â”‚
â”‚ ğŸ”’ æ¨™ç±¤ä¿è­·     â”‚ â”‚ ğŸ”’ æ¨™ç±¤ä¿è­·     â”‚ â”‚ ğŸ”’ æ¨™ç±¤ä¿è­·     â”‚ â”‚ ğŸ”’ æ¨™ç±¤ä¿è­·     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ—ï¸ ç¶²è·¯ç®¡ç†æ¶æ§‹èªªæ˜

äº”å€‹å°ˆæ¡ˆæ¡ç”¨å…©ç¨®ä¸åŒçš„ç¶²è·¯ç®¡ç†æ¨¡å¼ï¼š

| å°ˆæ¡ˆ         | ç¶²è·¯é…ç½®æ¨¡å¼ | æ¨™ç±¤ä¿è­·ç‹€æ…‹   | è¨­è¨ˆé‚è¼¯               |
|------------|--------|----------|--------------------|
| AI Ops     | å…§å»ºå®šç¾©ç¶²è·¯ | âœ… è‡ªå‹•æ¨™ç±¤ä¿è­· | ä¸»å°ˆæ¡ˆï¼Œå®Œæ•´å®šç¾©           |
| Grafana    | å…§å»ºå®šç¾©ç¶²è·¯ | âœ… è‡ªå‹•æ¨™ç±¤ä¿è­· | ç¨ç«‹ç³»çµ±ï¼Œå®Œæ•´å®šç¾©          |
| Akvorado   | å…§å»ºå®šç¾©ç¶²è·¯ | âœ… è‡ªå‹•æ¨™ç±¤ä¿è­· | ç¨ç«‹ç³»çµ±ï¼Œå®Œæ•´å®šç¾©          |
| PostgreSQL | å…§å»ºå®šç¾©ç¶²è·¯ | âœ… è‡ªå‹•æ¨™ç±¤ä¿è­· | ç¨ç«‹ç³»çµ±ï¼Œå®Œæ•´å®šç¾©          |
| N8N        | å¤–éƒ¨ç¶²è·¯å¼•ç”¨ | âŒ ç„¡æ¨™ç±¤ä¿è­·  | ä¾é™„æ–¼ ai-ops-network |

#### ç¶²è·¯ç®¡ç†æ¨¡å¼è©³ç´°å°æ¯”

| ç¶²è·¯åç¨± | ç®¡ç†æ¨¡å¼ | æ¨™ç±¤ä¿è­· | å‰µå»ºæ–¹å¼ | æŠ—æ¸…ç†èƒ½åŠ› |
|---------|---------|---------|---------|----------|
| **ai-ops-network** | ğŸ—ï¸ å…§å»ºè‡ªå‹•ç®¡ç† | âœ… Compose å®Œæ•´æ¨™ç±¤ | docker-compose.yml å®šç¾© | ğŸ”’ é˜²æ­¢ `docker system prune -a` |
| **grafana-network** | ğŸ—ï¸ å…§å»ºè‡ªå‹•ç®¡ç† | âœ… Compose å®Œæ•´æ¨™ç±¤ | docker-compose.yml å®šç¾© | ğŸ”’ é˜²æ­¢ `docker system prune -a` |
| **akvorado-network** | ğŸ—ï¸ å…§å»ºè‡ªå‹•ç®¡ç† | âœ… Compose å®Œæ•´æ¨™ç±¤ | docker-compose.yml å®šç¾© | ğŸ”’ é˜²æ­¢ `docker system prune -a` |
| **postgres-network** | ğŸ—ï¸ å…§å»ºè‡ªå‹•ç®¡ç† | âœ… Compose å®Œæ•´æ¨™ç±¤ | docker-compose.yml å®šç¾© | ğŸ”’ é˜²æ­¢ `docker system prune -a` |

**å…§å»ºè‡ªå‹•ç®¡ç†æ¨¡å¼å„ªå‹¢**ï¼š
- ğŸš€ **çµ±ä¸€ç®¡ç†**: å››å€‹æ ¸å¿ƒç³»çµ±æ¡ç”¨ä¸€è‡´çš„ç¶²è·¯ç®¡ç†æ–¹å¼
- ğŸ”’ **è‡ªå‹•ä¿è­·**: Docker Compose æ¨™ç±¤é˜²æ­¢æ„å¤–ç¶²è·¯åˆªé™¤
- âš¡ **è‡ªå‹•é‡å»º**: æœå‹™é‡å•Ÿæ™‚ç¶²è·¯è‡ªå‹•é‡å»ºï¼Œç„¡éœ€æ‰‹å‹•å¹²é 
- ğŸ›¡ï¸ **æ¸…ç†å®‰å…¨**: `docker system prune -a` ä¸å†å½±éŸ¿ç³»çµ±ç¶²è·¯
- ğŸ“Š **é…ç½®é€æ˜**: ç¶²è·¯é…ç½®å®Œå…¨åœ¨ docker-compose.yml ä¸­å®šç¾©
- ğŸŒ **è·¨ç¶²è·¯æ•´åˆ**: ai_ops_traefik çµ±ä¸€ä»£ç†å››å€‹ç³»çµ±çš„æœå‹™

**å¤–éƒ¨ç¶²è·¯å¼•ç”¨æ¨¡å¼ç‰¹æ€§**ï¼š
- âš ï¸ **ä¾é™„æ¨¡å¼**: N8N ä¾é™„æ–¼ ai-ops-networkï¼Œç°¡åŒ–éƒ¨ç½²
- ğŸ”— **ç›´æ¥é€£æ¥**: èˆ‡ä¸»ç³»çµ±å…±äº«ç¶²è·¯ç©ºé–“ï¼Œé™ä½è¤‡é›œåº¦
- ğŸ“‹ **æ¨™ç±¤ç¼ºå¤±**: ç¼ºå°‘ Docker Compose ä¿è­·æ¨™ç±¤ï¼Œéœ€è¦é¡å¤–æ³¨æ„
- ğŸ”„ **ä¾è³´é—œä¿‚**: ä¾è³´ä¸»ç³»çµ±ç¶²è·¯çš„ç”Ÿå‘½é€±æœŸ

## ğŸšª å°å¤–ç«¯å£æ˜ å°„

| å¤–éƒ¨ç«¯å£ | å…§éƒ¨ç›®æ¨™ | æœå‹™ | ç¶²è·¯ |
|---------|----------|------|------|
| **80** â†’ | ai_ops_traefik:80 | AI Ops Webç•Œé¢ | ai-ops-network |
| **81** â†’ | ai_ops_traefik:8080 | AI Opsç®¡ç†ç•Œé¢ | ai-ops-network |
| **8001** â†’ | n8n_main:5678 | N8Nå·¥ä½œæµ | ai-ops-network |
| **8002** â†’ | ai_ops_traefik:8002 | Akvorado Webç•Œé¢ | akvorado-network |
| **8003** â†’ | ai_ops_traefik:8003 | Grafana ç›£æ§ç•Œé¢ | grafana-network |
| **8004** â†’ | ai_ops_traefik:8004 | PostgreSQL TCPä»£ç† | postgres-network |
| **2055** â†’ | akvorado-akvorado-inlet-1:2055/udp | NetFlowæ¥æ”¶å™¨ | akvorado-network |
| **6343** â†’ | akvorado-akvorado-inlet-1:6343/udp | sFlowæ¥æ”¶å™¨ | akvorado-network |
| **10179** â†’ | akvorado-akvorado-outlet-1:10179 | BMPæœå‹™ | akvorado-network |

## ğŸ  AI Ops Network (172.21.0.0/16)

| å®¹å™¨åç¨± | å…§éƒ¨IP | å…§éƒ¨ç«¯å£ | æœå‹™æè¿° | ç‹€æ…‹ |
|----------|--------|----------|----------|------|
| **ai_ops_traefik** | 172.21.0.x (å‹•æ…‹åˆ†é…) | 80, 8080 | åå‘ä»£ç†å…¥å£é» | Healthy |
| **n8n_main** | 172.21.0.x (å‹•æ…‹åˆ†é…) | 5678 | å·¥ä½œæµè‡ªå‹•åŒ– | Healthy |
| **ai_ops_backend** | 172.21.0.x (å‹•æ…‹åˆ†é…) | 8000 | å¾Œç«¯API | Healthy |
| **ai_ops_frontend** | 172.21.0.x (å‹•æ…‹åˆ†é…) | 80 | Reactå‰ç«¯ (Nginxéœæ…‹æœå‹™) | Healthy |

### AI Opsç¶²è·¯ç‰¹æ€§
- **å­ç¶²æ®µ**: 172.21.0.0/16
- **ç¶²é—œ**: 172.21.0.1 (å®¿ä¸»æ©Ÿ)
- **ç”¨é€”**: AIé‹ç¶­ç³»çµ±ã€å·¥ä½œæµè‡ªå‹•åŒ–
- **ä¸»è¦æœå‹™**: Webç•Œé¢ã€APIå¾Œç«¯ã€N8Nå·¥ä½œæµã€MCPæœå‹™

### AI Opsæµé‡è·¯ç”±æ©Ÿåˆ¶
```
å¤–éƒ¨è«‹æ±‚ â†’ ai_ops_traefik:80 â† åå‘ä»£ç†å…¥å£é»
    â†“ æ ¹æ“šè·¯ç”±è¦å‰‡åˆ†ç™¼æµé‡
    â”œâ”€ PathPrefix(`/api/`) â†’ ai_ops_backend:8000
    â””â”€ æ ¹è·¯å¾‘ (`/`) â†’ ai_ops_frontend:80

è·¯ç”±è¦å‰‡è©³è§£ï¼š
â€¢ å¤–éƒ¨è¨ªå• 202.3.184.82/ â†’ Traefik â†’ Frontend (Nginxéœæ…‹æª”æ¡ˆ)
â€¢ å¤–éƒ¨è¨ªå• 202.3.184.82/api/ â†’ Traefik â†’ Backend (FastAPI)
â€¢ å®¹å™¨80ç«¯å£ä¸è¡çªï¼šTraefikæš´éœ²åˆ°å®¿ä¸»æ©Ÿï¼ŒFrontendåƒ…å…§ç¶²å¯è¦‹
```

## ğŸ“Š Akvorado Network (172.22.0.0/16)

| å®¹å™¨åç¨± | å…§éƒ¨IP | å…§éƒ¨ç«¯å£ | æœå‹™æè¿° | ç‹€æ…‹ |
|----------|--------|----------|----------|------|
| **akvorado-traefik-1** | 172.22.0.x (å‹•æ…‹åˆ†é…) | 8002, 8080 | åå‘ä»£ç† | Running |
| **akvorado-redis-1** | 172.22.0.x (å‹•æ…‹åˆ†é…) | 6379 | å¿«å–æ•¸æ“šåº« | Healthy |
| **akvorado-kafka-1** | 172.22.0.x (å‹•æ…‹åˆ†é…) | 9092 | è¨Šæ¯ä½‡åˆ— | Healthy |
| **akvorado-clickhouse-1** | 172.22.0.x (å‹•æ…‹åˆ†é…) | 8123, 9000, 9009 | åˆ†ææ•¸æ“šåº« | Healthy |
| **akvorado-kafka-ui-1** | 172.22.0.x (å‹•æ…‹åˆ†é…) | 8080 | Kafkaç®¡ç†ç•Œé¢ | Running |
| **akvorado-akvorado-orchestrator-1** | 172.22.0.x (å‹•æ…‹åˆ†é…) | 8080 | å”èª¿å™¨ | Healthy |
| **akvorado-akvorado-inlet-1** | 172.22.0.x (å‹•æ…‹åˆ†é…) | 8080 | æ•¸æ“šæ¥æ”¶å™¨ | Healthy |
| **akvorado-akvorado-outlet-1** | 172.22.0.x (å‹•æ…‹åˆ†é…) | 8080 | æ•¸æ“šè¼¸å‡ºå™¨ | Healthy |
| **akvorado-akvorado-console-1** | 172.22.0.x (å‹•æ…‹åˆ†é…) | 8080 | Webæ§åˆ¶å° | Healthy |
| **akvorado-geoip-1** | 172.22.0.x (å‹•æ…‹åˆ†é…) | N/A | GeoIP æ•¸æ“šæ›´æ–° | Running |

### Akvoradoç¶²è·¯ç‰¹æ€§
- **å­ç¶²æ®µ**: 172.22.0.0/16
- **ç¶²é—œ**: 172.22.0.1 (å®¿ä¸»æ©Ÿ)
- **ç”¨é€”**: ç¶²è·¯æµé‡åˆ†æå’Œç›£æ§
- **ä¸»è¦æœå‹™**: æµé‡æ”¶é›†ã€æ•¸æ“šåˆ†æã€Webå„€è¡¨æ¿

## ğŸ“Š Grafana Network (172.23.0.0/16)

| å®¹å™¨åç¨± | å…§éƒ¨IP | å…§éƒ¨ç«¯å£ | æœå‹™æè¿° | ç‹€æ…‹ |
|----------|--------|----------|----------|------|
| **grafana_dashboard** | 172.23.0.x (å‹•æ…‹åˆ†é…) | 3000 | Grafana å„€è¡¨æ¿ | Running |
| **grafana_prometheus** | 172.23.0.x (å‹•æ…‹åˆ†é…) | 9090 | Prometheus ç›£æ§ | Running |
| **grafana_loki** | 172.23.0.x (å‹•æ…‹åˆ†é…) | 3100 | Loki æ—¥èªŒèšåˆ | Running |
| **grafana_node_exporter** | 172.23.0.x (å‹•æ…‹åˆ†é…) | 9100 | ç¯€é»ç›£æ§ | Running |
| **grafana_cadvisor** | 172.23.0.x (å‹•æ…‹åˆ†é…) | 8080 | å®¹å™¨ç›£æ§ | Running |
| **grafana_snmp_exporter** | 172.23.0.x (å‹•æ…‹åˆ†é…) | 9116 | SNMP ç›£æ§ | Running |

### Grafanaç¶²è·¯ç‰¹æ€§
- **å­ç¶²æ®µ**: 172.23.0.0/16
- **ç¶²é—œ**: 172.23.0.1 (å®¿ä¸»æ©Ÿ)
- **ç”¨é€”**: ç³»çµ±ç›£æ§å’Œå¯è¦–åŒ–
- **ä¸»è¦æœå‹™**: æŒ‡æ¨™æ”¶é›†ã€æ—¥èªŒèšåˆã€ç›£æ§å„€è¡¨æ¿

## ğŸ—ƒï¸ PostgreSQL Network (172.99.0.0/16)

| å®¹å™¨åç¨± | å…§éƒ¨IP | å…§éƒ¨ç«¯å£ | æœå‹™æè¿° | ç‹€æ…‹ |
|----------|--------|----------|----------|------|
| **postgres_main** | 172.99.0.x (å‹•æ…‹åˆ†é…) | 5432 | PostgreSQL ä¸»è³‡æ–™åº« | Running |
| **postgres_pgadmin** | 172.99.0.x (å‹•æ…‹åˆ†é…) | 80 | pgAdmin ç®¡ç†ç•Œé¢ | Running |

### PostgreSQLç¶²è·¯ç‰¹æ€§
- **å­ç¶²æ®µ**: 172.99.0.0/16
- **ç¶²é—œ**: 172.99.0.1 (å®¿ä¸»æ©Ÿ)
- **ç”¨é€”**: é—œè¯å¼è³‡æ–™åº«æœå‹™
- **ä¸»è¦æœå‹™**: è³‡æ–™å­˜å„²ã€å‚™ä»½ã€è³‡æ–™åº«ç®¡ç†

## ğŸ”§ ç‰¹æ®Šç¶²è·¯é…ç½®

| å®¹å™¨åç¨± | ç¶²è·¯æ¨¡å¼ | æè¿° | ç”¨é€” |
|----------|----------|------|------|
| **akvorado-akvorado-conntrack-fixer-1** | host | ç›´æ¥ä½¿ç”¨å®¿ä¸»æ©Ÿç¶²è·¯ | ä¿®å¾©conntrackå•é¡Œ |

## ğŸŒ å¤–éƒ¨è¨ªå•æ–¹å¼

### å¤–éƒ¨ç”¨æˆ¶è¨ªå• (202.3.184.82)
```
202.3.184.82:80    â†’ AI Opsç³»çµ±ä¸»ç•Œé¢
202.3.184.82:81    â†’ AI Opsç®¡ç†ç•Œé¢  
202.3.184.82:8001  â†’ N8Nå·¥ä½œæµç®¡ç†
202.3.184.82:8002  â†’ Akvoradoç¶²è·¯ç›£æ§å„€è¡¨æ¿
202.3.184.82:8003  â†’ Grafanaç›£æ§å„€è¡¨æ¿
202.3.184.82:8004  â†’ PostgreSQL TCPä»£ç†
202.3.184.82:2055  â†’ NetFlowæ•¸æ“šæ¥æ”¶ (UDP)
202.3.184.82:6343  â†’ sFlowæ•¸æ“šæ¥æ”¶ (UDP)  
202.3.184.82:10179 â†’ BMPå”è­°æœå‹™
```

### å…§éƒ¨è¨ªå• (10.60.21.11)
```
10.60.21.11:80     â†’ AI Opsç³»çµ±ä¸»ç•Œé¢
10.60.21.11:81     â†’ AI Opsç®¡ç†ç•Œé¢
10.60.21.11:8001   â†’ N8Nå·¥ä½œæµç®¡ç†  
10.60.21.11:8002   â†’ Akvoradoç¶²è·¯ç›£æ§å„€è¡¨æ¿
10.60.21.11:8003   â†’ Grafanaç›£æ§å„€è¡¨æ¿
10.60.21.11:8004   â†’ PostgreSQL TCPä»£ç†
10.60.21.11:2055   â†’ NetFlowæ•¸æ“šæ¥æ”¶ (UDP)
10.60.21.11:6343   â†’ sFlowæ•¸æ“šæ¥æ”¶ (UDP)
10.60.21.11:10179  â†’ BMPå”è­°æœå‹™
```

## ğŸ·ï¸ Docker Compose æ¨™ç±¤ä¿è­·æ©Ÿåˆ¶

### ç¶²è·¯æ¨™ç±¤ä¿è­·è©³æƒ…

å››å€‹ç³»çµ±ç¶²è·¯ç¾åœ¨éƒ½å…·æœ‰å®Œæ•´çš„ Docker Compose ä¿è­·æ¨™ç±¤ï¼š

#### AI Ops Network æ¨™ç±¤
```json
{
  "com.docker.compose.config-hash": "c6749a2abdcb04b753fd9eb5b52aed39e572d929acb48a4581855a96f0967609",
  "com.docker.compose.network": "ai-ops-network", 
  "com.docker.compose.project": "ai_ops_assistant_gemini",
  "com.docker.compose.version": "2.39.1"
}
```

#### Akvorado Network æ¨™ç±¤
```json
{
  "com.docker.compose.config-hash": "e970f81dd7d90997246c6d96aa437686cfa5aec0f2da660fea934c7dbe0fb196",
  "com.docker.compose.network": "default",
  "com.docker.compose.project": "akvorado", 
  "com.docker.compose.version": "2.39.1"
}
```

#### PostgreSQL Network æ¨™ç±¤
```json
{
  "com.docker.compose.config-hash": "9bf679040a1eeb1f858e115e22518840ff013e3be24a696713cb9c9a177c20b8",
  "com.docker.compose.network": "postgres-network",
  "com.docker.compose.project": "postgresql", 
  "com.docker.compose.version": "2.39.1"
}
```

### æ¨™ç±¤ä¿è­·æ•ˆæœé©—è­‰

```bash
# æª¢æŸ¥ç¶²è·¯æ¨™ç±¤
docker network inspect ai-ops-network --format='{{json .Labels}}' | jq -r .
docker network inspect grafana-network --format='{{json .Labels}}' | jq -r .
docker network inspect akvorado-network --format='{{json .Labels}}' | jq -r .
docker network inspect postgres-network --format='{{json .Labels}}' | jq -r .

# æ¸¬è©¦æ¸…ç†å‘½ä»¤å®‰å…¨æ€§
docker system prune -a -f  # ç¾åœ¨å¯ä»¥å®‰å…¨ä½¿ç”¨ï¼Œä¸æœƒåˆªé™¤ç³»çµ±ç¶²è·¯

# ç¢ºèªç¶²è·¯ä»å­˜åœ¨
docker network ls | grep -E "(ai-ops-network|grafana-network|akvorado-network|postgres-network)"
```

**é‡è¦æ”¹é€²**ï¼š
- âœ… **å››é‡ä¿è­·**ï¼šå››å€‹ç³»çµ±éƒ½å…·å‚™ Compose æ¨™ç±¤ä¿è­·
- âœ… **çµ±ä¸€ç®¡ç†**ï¼šæ¶ˆé™¤ç®¡ç†æ–¹å¼å·®ç•°ï¼Œé™ä½é‹ç¶­è¤‡é›œåº¦  
- âœ… **è‡ªå‹•æ¢å¾©**ï¼šæœå‹™é‡å•Ÿæ™‚ç¶²è·¯è‡ªå‹•é‡å»º
- âœ… **æ¸…ç†å®‰å…¨**ï¼šç³»çµ±æ¸…ç†å‘½ä»¤ä¸å†å½±éŸ¿æ ¸å¿ƒç¶²è·¯æ¶æ§‹

## ğŸ”’ ç¶²è·¯éš”é›¢ç­–ç•¥èˆ‡å®¹å™¨é–“é€šä¿¡

### çµ±ä¸€ç®¡ç†çš„å¤šç³»çµ±æ¶æ§‹ - è·¨ç¶²è·¯ + æ¨™ç±¤è·¯ç”±æ©Ÿåˆ¶
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AI Ops System     â”‚    â”‚   Akvorado System       â”‚
â”‚   172.21.0.0/16     â”‚    â”‚   172.22.0.0/16         â”‚
â”‚                     â”‚    â”‚                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Traefik     â”‚   â”‚    â”‚   â”‚ Traefik         â”‚   â”‚
â”‚   â”‚ (Proxy)     â”‚   â”‚    â”‚   â”‚ (Proxy)         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Frontend    â”‚   â”‚    â”‚   â”‚ Console         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Backend     â”‚   â”‚    â”‚   â”‚ Orchestrator    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ N8N         â”‚   â”‚    â”‚   â”‚ Inlet/Outlet    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ MCP Servicesâ”‚   â”‚    â”‚   â”‚ ClickHouse      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘                            â†‘
        â”‚                            â”‚
    Port 80,81,8001              Port 8002,2055,
                                 6343,10179
```

### ç«¯å£æš´éœ²èˆ‡å…§éƒ¨é€šä¿¡èªªæ˜

#### ç«¯å£é¡å‹å€åˆ¥
- **æš´éœ²ç«¯å£ (ports)**ï¼šæ˜ å°„åˆ°å®¿ä¸»æ©Ÿï¼Œå¤–éƒ¨å¯è¨ªå•
- **å…§éƒ¨ç«¯å£ (expose)**ï¼šåƒ…åœ¨Dockerç¶²è·¯å…§å¯è¦‹

```
AI Ops ç«¯å£é…ç½®ï¼š
â€¢ ai_ops_traefik: 80:80, 81:8080 (æš´éœ²) â†’ å¤–éƒ¨å…¥å£é»
â€¢ ai_ops_frontend: 80 (åƒ…å…§éƒ¨) â†’ æ¥æ”¶Traefikè½‰ç™¼
â€¢ ai_ops_backend: 8000 (åƒ…å…§éƒ¨) â†’ æ¥æ”¶Traefikè½‰ç™¼
â€¢ n8n_main: 8001:5678 (æš´éœ²) â†’ ç›´æ¥å¤–éƒ¨è¨ªå•

å®¹å™¨é–“é€šä¿¡ï¼š
â€¢ åŒç¶²è·¯å…§ä½¿ç”¨å®¹å™¨åç¨±ï¼šai_ops_backend:8000
â€¢ åŒç¶²è·¯å…§ä½¿ç”¨å…§éƒ¨IPï¼š172.21.0.x:8000 (å‹•æ…‹åˆ†é…)
â€¢ Traefikè‡ªå‹•ç™¼ç¾ï¼šé€šéDockeræ¨™ç±¤é…ç½®è·¯ç”±
```

#### Traefik è·¯ç”±éš”é›¢é…ç½®

**AI Ops Traefik é…ç½®** (`/home/sysadmin/ai_ops_assistant_gemini/traefik/traefik.yml`):
```yaml
providers:
  docker:
    network: "ai-ops-network"
    constraints: "Label(`traefik.constraint-label`,`ai-ops`)"
```

**Akvorado Traefik é…ç½®** (`/home/sysadmin/akvorado/docker-compose.yml`):
```yaml
environment:
  TRAEFIK_PROVIDERS_DOCKER_NETWORK: "akvorado-network"
  TRAEFIK_PROVIDERS_DOCKER_CONSTRAINTS: "Label(`traefik.constraint-label`,`akvorado`)"
```

**æœå‹™æ¨™ç±¤ç¯„ä¾‹**:
```yaml
# AI Ops æœå‹™
labels:
  - traefik.enable=true
  - traefik.constraint-label=ai-ops

# Akvorado æœå‹™  
labels:
  - traefik.enable=true
  - traefik.constraint-label=akvorado
```

#### ç‚ºä»€éº¼å…©å€‹å®¹å™¨éƒ½æœ‰80ç«¯å£ä½†ä¸è¡çªï¼Ÿ
1. **ä¸åŒç¶²è·¯å±¤ç´š**ï¼š
   - Traefikçš„80ç«¯å£æš´éœ²åˆ°å®¿ä¸»æ©Ÿ (0.0.0.0:80â†’å®¹å™¨:80)
   - Frontendçš„80ç«¯å£åƒ…åœ¨å®¹å™¨ç¶²è·¯å…§ (172.21.0.x:80)

2. **æµé‡æµå‘**ï¼š
   ```
   å¤–éƒ¨ â†’ å®¿ä¸»æ©Ÿ:80 â†’ ai_ops_traefik:80 â†’ æ ¹æ“šè·¯ç”± â†’ ai_ops_frontend:80
   ```

3. **Dockerç¶²è·¯éš”é›¢**ï¼šæ¯å€‹å®¹å™¨åœ¨ç¨ç«‹çš„ç¶²è·¯å‘½åç©ºé–“å…§é‹è¡Œ

## ğŸ›¡ï¸ Traefik çµ±ä¸€è·¯ç”±ç®¡ç†æ©Ÿåˆ¶è©³è§£

### æ¶æ§‹è¨­è¨ˆç†å¿µ
AI Ops Traefik æ¡ç”¨çµ±ä¸€ç®¡ç†æ¨¡å¼ï¼Œä½œç‚ºå››å€‹ç³»çµ±ï¼ˆai-ops, grafana, akvorado, postgresï¼‰çš„ä¸­å¤®è·¯ç”±å™¨ï¼š
- çµ±ä¸€çš„åå‘ä»£ç†å…¥å£é»
- è·¨ç¶²è·¯æœå‹™ç™¼ç¾å’Œè·¯ç”±
- åŸºæ–¼æ¨™ç±¤çš„ç²¾ç¢ºè·¯ç”±æ§åˆ¶

### å¯¦æ–½æ–¹æ¡ˆï¼šçµ±ä¸€æ¨™ç±¤ç´„æŸç®¡ç†

#### 1. çµ±ä¸€æ¨™ç±¤ç´„æŸç®¡ç†
Traefik é€šéæ¨™ç±¤ç´„æŸå¯¦ç¾ç²¾ç¢ºçš„æœå‹™ç™¼ç¾ï¼š
```yaml
# çµ±ä¸€ Traefik æ”¯æ´å››å€‹ç³»çµ±çš„æœå‹™ç™¼ç¾
constraints: "Label(`traefik.constraint-label`,`ai-ops`) || Label(`traefik.constraint-label`,`grafana`) || Label(`traefik.constraint-label`,`akvorado`) || Label(`traefik.constraint-label`,`postgres`)"

# é è¨­è·¯ç”±è¦å‰‡
defaultRule: "Host(`10.60.21.11`) || Host(`202.3.184.82`)"
```

#### 2. è·¨ç¶²è·¯é€£æ¥é…ç½®
ai_ops_traefik é€£æ¥åˆ°å¤šå€‹ç¶²è·¯ä»¥å¯¦ç¾çµ±ä¸€ç®¡ç†ï¼š
```yaml
networks:
  - ai-ops-network      # ä¸»è¦ç®¡ç†ç¶²è·¯
  - grafana-network     # Grafana ç›£æ§ç¶²è·¯
  - akvorado-network    # Akvorado ç¶²è·¯ç›£æ§ç¶²è·¯
  - postgres-network    # PostgreSQL è³‡æ–™åº«ç¶²è·¯
```

#### 3. è·¯ç”±çµ±ä¸€ç®¡ç†æ•ˆæœ
```bash
# çµ±ä¸€ Traefik ç®¡ç†æ‰€æœ‰ç³»çµ±è·¯ç”±ï¼š
# - api@internal, dashboard@internal, ping@internal (Traefik å…§éƒ¨ç®¡ç†)
# - backend@docker, backend-health@docker, frontend@docker (AI Ops ç³»çµ±)
# - n8n@docker (N8N å·¥ä½œæµ)
# - grafana@docker (Grafana ç›£æ§)
# - akvorado-*@docker (Akvorado ç¶²è·¯ç›£æ§ç³»çµ±)
# - kafka-ui@docker, clickhouse@docker (Akvorado ç›¸é—œæœå‹™)
# - postgres@docker, pgadmin@docker (PostgreSQL è³‡æ–™åº«ç³»çµ±)
```

## ğŸ“ ç¶­è­·èªªæ˜

### ç¶²è·¯ç®¡ç†å‘½ä»¤
```bash
# æŸ¥çœ‹æ‰€æœ‰Dockerç¶²è·¯
docker network ls

# æª¢æŸ¥ç‰¹å®šç¶²è·¯é…ç½®
docker network inspect ai-ops-network
docker network inspect akvorado-network

# æŸ¥çœ‹å®¹å™¨ç¶²è·¯é…ç½®
docker ps --format "table {{.Names}}\t{{.Image}}\t{{.Ports}}\t{{.Networks}}"

# æª¢æŸ¥ç«¯å£ä½¿ç”¨æƒ…æ³
netstat -tlpn | grep -E ":(80|81|8001|8002|2055|6343|10179)\s"

# æª¢æŸ¥å®¹å™¨å…§éƒ¨é€£æ¥
docker exec ai_ops_traefik wget -qO- http://ai_ops_frontend:80
docker exec ai_ops_traefik wget -qO- http://ai_ops_backend:8000/health
```

### ç¶²è·¯è¨ºæ–·æŒ‡ä»¤

âš ï¸ **é‡è¦**: ç”±æ–¼ NAT ç’°å¢ƒé™åˆ¶ï¼Œå…§éƒ¨æ¸¬è©¦å¿…é ˆä½¿ç”¨å…§ç¶² IP `10.60.21.11`ï¼Œä¸èƒ½ä½¿ç”¨å¤–éƒ¨ IP `202.3.184.82`

```bash
# æ¸¬è©¦å®¹å™¨é–“é€£é€šæ€§
docker exec ai_ops_traefik ping -c 3 ai_ops_frontend
docker exec ai_ops_traefik ping -c 3 ai_ops_frontend

# æª¢æŸ¥Traefikè·¯ç”±é…ç½®
docker exec ai_ops_traefik wget -qO- http://localhost:8080/api/http/routers

# æª¢æŸ¥æœå‹™ç™¼ç¾
docker exec ai_ops_traefik wget -qO- http://localhost:8080/api/http/services

# å¤–éƒ¨è¨ªå•æ¸¬è©¦ (ä½¿ç”¨å…§ç¶² IP)
curl -s -o /dev/null -w "%{http_code}" http://10.60.21.11/health          # AI Ops å¾Œç«¯
curl -s -o /dev/null -w "%{http_code}" http://10.60.21.11/                # AI Ops å‰ç«¯  
curl -s -o /dev/null -w "%{http_code}" http://10.60.21.11:8002/           # Akvorado Console
curl -s -o /dev/null -w "%{http_code}" http://10.60.21.11:8002/kafka-ui/  # Kafka UI

# é©—è­‰è·¯ç”±éš”é›¢æ•ˆæœ
docker exec ai_ops_traefik wget -qO- http://localhost:8080/api/http/routers | jq -r '.[].name' | sort
# æ‡‰è©²åªçœ‹åˆ°ï¼šapi@internal, backend@docker, backend-health@docker, dashboard@internal, frontend@docker, n8n@docker, ping@internal
```

### ğŸ”„ ç¶²è·¯ç®¡ç†æ¨¡å¼èªªæ˜

**v5.0 é‡å¤§æ”¹é€²**: äº”å€‹å°ˆæ¡ˆæ¡ç”¨å…©ç¨®ç¶²è·¯ç®¡ç†æ¨¡å¼ï¼Œå››å€‹æ ¸å¿ƒç³»çµ±çµ±ä¸€ç®¡ç†ï¼š

| ç³»çµ± | ç¶²è·¯ç®¡ç†æ¨¡å¼ | Docker Compose æ¨™ç±¤ä¿è­· | æŠ—æ¸…ç†èƒ½åŠ› |
|------|------------|-------------------|----------|
| **AI Ops** | âœ… å…§å»ºè‡ªå‹•ç®¡ç† | âœ… å®Œæ•´æ¨™ç±¤ | ğŸ”’ é˜²æ­¢æ„å¤–åˆªé™¤ |
| **Grafana** | âœ… å…§å»ºè‡ªå‹•ç®¡ç† | âœ… å®Œæ•´æ¨™ç±¤ | ğŸ”’ é˜²æ­¢æ„å¤–åˆªé™¤ |
| **Akvorado** | âœ… å…§å»ºè‡ªå‹•ç®¡ç† | âœ… å®Œæ•´æ¨™ç±¤ | ğŸ”’ é˜²æ­¢æ„å¤–åˆªé™¤ |
| **PostgreSQL** | âœ… å…§å»ºè‡ªå‹•ç®¡ç† | âœ… å®Œæ•´æ¨™ç±¤ | ğŸ”’ é˜²æ­¢æ„å¤–åˆªé™¤ |
| **N8N** | âš ï¸ å¤–éƒ¨ç¶²è·¯å¼•ç”¨ | âŒ ç¼ºå°‘æ¨™ç±¤ | âš ï¸ ä¾è³´ä¸»ç³»çµ±ä¿è­· |

**æ¶æ§‹å„ªå‹¢**: 
- å››å€‹æ ¸å¿ƒç³»çµ±ï¼š`docker system prune -a` ä¸å†å½±éŸ¿ç¶²è·¯
- çµ±ä¸€ç®¡ç†æ–¹å¼ï¼Œé™ä½ç¶­è­·è¤‡é›œåº¦
- ç¶²è·¯é…ç½®ç”± Docker Compose å®Œå…¨ç®¡ç†
- ai_ops_traefik ä½œç‚ºä¸­å¤®è·¯ç”±å™¨çµ±ä¸€ä»£ç†å››å€‹ç³»çµ±
- N8N æ¡ç”¨ä¾é™„æ¨¡å¼ï¼Œç°¡åŒ–éƒ¨ç½²ä¸¦å…±äº«ç¶²è·¯è³‡æº

### ç¶²è·¯é‡å»ºæŒ‡ä»¤ (å¦‚éœ€è¦)

âš ï¸ **æ”¹é€²æé†’**: ç”±æ–¼å››å€‹æ ¸å¿ƒç³»çµ±éƒ½ä½¿ç”¨å…§å»ºç¶²è·¯ç®¡ç†ï¼Œç¾åœ¨å¯ä»¥å®‰å…¨ä½¿ç”¨ `docker system prune -a`
âš ï¸ **æ³¨æ„äº‹é …**: N8N ä½¿ç”¨å¤–éƒ¨ç¶²è·¯å¼•ç”¨ï¼Œæ¸…ç†å‰è«‹ç¢ºèª ai-ops-network çš„ç‹€æ…‹

```bash
# ç¾åœ¨å¯ä»¥å®‰å…¨ä½¿ç”¨çš„æ¸…ç†å‘½ä»¤
docker system prune -a -f

# ç¶²è·¯æœƒè‡ªå‹•é‡å»º (å¦‚æœå®¹å™¨é‡å•Ÿ)
cd /home/sysadmin/ai_ops_assistant_gemini && docker compose up -d
cd /home/sysadmin/akvorado && docker compose up -d

# é‡æ–°å•Ÿå‹•æœå‹™ä»¥æ‡‰ç”¨ç¶²è·¯éš”é›¢é…ç½®
cd /home/sysadmin/ai_ops_assistant_gemini && docker compose restart traefik
cd /home/sysadmin/akvorado && docker compose restart traefik
```

---

**æœ€å¾Œæ›´æ–°**: 2025-08-29  
**æ–‡æª”ç‰ˆæœ¬**: 5.1  
**ç³»çµ±ç‹€æ…‹**: é‹è¡Œæ­£å¸¸ï¼Œå¯¦æ–½çµ±ä¸€ Traefik è·¯ç”±ç®¡ç†ï¼Œ**äº”å€‹å°ˆæ¡ˆæ¡ç”¨å…©ç¨®ç¶²è·¯ç®¡ç†æ¨¡å¼**  
**æ›´æ–°å…§å®¹**: 
- **v5.1**: **ç¶²è·¯ç®¡ç†æ¨¡å¼æ¾„æ¸…** - ä¿®æ­£ç¶²è·¯é…ç½®æ¨¡å¼æè¿°ï¼š
  - ğŸ“Š æ–°å¢å°ˆæ¡ˆç¶²è·¯é…ç½®æ¨¡å¼å°æ¯”è¡¨æ ¼
  - ğŸ” å€åˆ†å…§å»ºå®šç¾©ç¶²è·¯èˆ‡å¤–éƒ¨ç¶²è·¯å¼•ç”¨å…©ç¨®æ¨¡å¼
  - ğŸ“‹ æ˜ç¢ºå››å€‹æ ¸å¿ƒç³»çµ±ï¼ˆAI Ops, Grafana, Akvorado, PostgreSQLï¼‰æ¡ç”¨å…§å»ºç®¡ç†
  - âš ï¸ æ¨™è¨» N8N æ¡ç”¨å¤–éƒ¨ç¶²è·¯å¼•ç”¨æ¨¡å¼ï¼Œä¾é™„æ–¼ ai-ops-network
  - ğŸ›¡ï¸ æ›´æ–°ç¶²è·¯ä¿è­·æ©Ÿåˆ¶èªªæ˜ï¼Œåæ˜ å¯¦éš›é…ç½®å·®ç•°
- **v5.0**: **é‡å¤§æ¶æ§‹å‡ç´š** - å¾é›™ç³»çµ±æ“´å±•ç‚ºå››ç³»çµ±çµ±ä¸€ç®¡ç†ï¼š
  - ğŸŒ æ–°å¢ Grafana Network (172.23.0.0/16) ç›£æ§ç³»çµ±
  - ğŸ—ƒï¸ æ–°å¢ PostgreSQL Network (172.99.0.0/16) è³‡æ–™åº«ç³»çµ±
  - ğŸšª æ–°å¢ç«¯å£ 8003 (Grafana) å’Œ 8004 (PostgreSQL TCPä»£ç†)
  - ğŸ”§ å‡ç´š ai_ops_traefik ç‚ºå››ç³»çµ±ä¸­å¤®è·¯ç”±å™¨
  - ğŸ“Š æ›´æ–°ç¶²è·¯æ¶æ§‹åœ–å’ŒåŸºç¤è¨­æ–½æè¿°
  - âš™ï¸ Traefik ç´„æŸæ¢ä»¶å‡ç´šæ”¯æ´å››ç³»çµ±æ¨™ç±¤
- æ–°å¢å®Œæ•´çš„ Grafana å’Œ PostgreSQL ç¶²è·¯é…ç½®èªªæ˜
- æ›´æ–°å°å¤–è¨ªå•ç«¯å£æ˜ å°„è¡¨
- ä¿®æ­£ç¶²è·¯ç®¡ç†æ¨¡å¼èªªæ˜
- **æ­·å²ç‰ˆæœ¬**:
  - **v4.1**: ä¿®æ­£å¯¦éš›ç³»çµ±ç‹€æ…‹å·®ç•°ï¼Œæ›´æ–°å®¹å™¨åç¨±å’Œ IP åˆ†é…
  - **v4.0**: é›™ç³»çµ±ç¶²è·¯ç®¡ç†æ¨¡å¼çµ±ä¸€å‡ç´š
  - **v3.1**: ä¿®æ­£å®¹å™¨ IP åœ°å€å’Œè¨ºæ–·å‘½ä»¤